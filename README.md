# FREE:Enhanced Feature Representation for Isotopic Envelope Evaluation in Top-Down Mass Spectra Deconvolution
{Motivation:}The aim of deconvolution of top-down mass spectra is to recognize  monoisotopic peaks from the experimental envelopes in raw mass spectra. So accurate assessment of similarity between theoretical and experimental envelopes is a critical step in mass spectra data deconvolution. Existing evaluation methods primarily rely on intensity differences and m/z similarity, potentially lacking a comprehensive assessment. To overcome this constraint and facilitate a comprehensive and refined assessment of the similarity between theoretical and experimental envelopes, there exists an imperative to systematically explore and identify increasingly efficacious features for assessing this correspondence.


{Results:}  We present FREE(enhanced Feature Representation for isotopic Envelope Evaluation) that proficiently derives diverse feature representations, encapsulating fundamental physical attributes of envelopes, including peak intensity and envelope shape. We trained FREE and evaluated its performance on both the OT(human ovarian tumor cells) data set and the ZF(brain in mature female zebrafis) data set. Specifically, comparing the state-of-art method，FREE achieved higher accuracy and ROCAUC scores on both the OT and ZF data sets, and it demonstrated accurate predictions of a greater number of positive envelopes among the top-ranked envelopes based on their scores. Moreover, within a specific dataset to ZF, the amalgamation of FREE with TopFD exhibits a commendable capacity to discern 117,883 fragment ions, thus surpassing the 97,554 fragment ions identified through the application of EnvCNN in conjunction with TopFD. Notably, among these fragment ions, those that achieve validation through the identification of PrSMs(peptide-spectrum matches) by TopPIC result in a significant improvement of up to 21%.

"Required Files:"

(1) A top-down spectral data file in either mzML, mzXML, or Raw format.
(2) A corresponding protein database in fasta format.
"Processing Steps:"

1.File Format Conversion:
Utilize ProteoWizard MSConvert to convert the raw file into an mzML file.
2.Deconvolution:
Apply TopFD for deconvoluting the mzML/mzXML file.
This process will generate feature files, msalign files, and a list of env files.
3.Proteoforms Search:
Employ TopPIC for performing the search for proteoforms.
This step requires the protein database (*.fasta) file, msalign files, and feature files.


"Genarating Traindata"
1.Rename PrSM Files:
FREE/Exec/change_xml_files.py
2.Rename Envelope Files:
FREE/Exec/change_env_files.py
3.Generate the annotated spectra files:
FREE/Exec/add_anno.py
4.Generate the feature file:
FREE/Exec/add_feature.py
5.Generate the training data:
FREE/Exec/genarate_training_data.py
6.Generate HDF5 file
FREE/Exec/create_hdf5_file.py


"Train Model"
Use the hdf5 file to train the model: FREE/Exec/train_model_hdf5.py


"Test model"
1.the evaluation criteria for binary classification:
FREE/Exec/test_model.py
Generate the ROC plot:FREE/Exec/generate_roc_plot.py
2.Analysis based on model prediction scores:
(1)Employ the trained model to generate predictive scores for the envelopes：FREE/Exec/add_prediction_score.py
(2)Generate the Rank plot:FREE/Exec/generate_rank_plot.py
3.Analysis of the results in combination with proteoform identification
(1)Download TopFD utilizing EnvCNN model for scoring isotopmer envelopes.
i.You can downlaod the binaries using: https://github.com/toppic-suite/envcnn/releases/download/v1.0-beta/topfd-with-EnvCNN-linux-1.0-beta.zip
ii.You can download/clone the modified version of the TopFD from https://github.com/toppic-suite/toppic-suite using GitHub branch "with_EnvCNN".
(2)Accomodate your own trained model.
i.Convert your model to json file:FREE/Exec/convert_model_to_json.py
ii.Copy the json file to the toppic_resources directory in the toppic repository and run the TopFD for spectral deconvolution.
(3)
Integrate the feature files generated by TopFD+FREE into the TopPIC platform for comprehensive protein identification and analysis.
